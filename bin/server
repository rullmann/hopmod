#!/bin/sh

export PATH=$PATH:.
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:bin

execOnServer(){
    if [ -p serverexec ] 
    then
        echo $1 > serverexec
    fi
}

case "$1" in
    'start')
        
        if [ -p serverexec ]
        then
            echo "It appears the server is already running."
            exit 1
        fi
        
        # enable core dump
        ulimit -c unlimited
        
        # cleanup and initiation
        rm -f log/status.log
        touch log/status.log
        touch log/error.log
        
        tail -c 0 -f log/error.log &
        tail -f log/status.log &
        
        # start the game server as a background process
        nohup bin/sauer_server $SERVER_OPTIONS 1>log/status.log 2>log/error.log </dev/null &
        
        sleep 1
        
        kill %1
        kill %2
;;
    'restart')
        execOnServer restart
;;
    'stop')
        execOnServer shutdown
;;
    *)
        $0 start
esac
