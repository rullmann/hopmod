path-constant LIB_PATH : bin ;
path-constant SCRIPT_PACKAGE_PATH : script/package ;

use-project /boost : src/boost ;
use-project /lua : src/lua ;
use-project /fungu : src/fungu ;
use-project /lua-sqlite3 : src/lua-sqlite3 ;
use-project /libmicrohttpd : src/libmicrohttpd ;

lib enet :
    src/enet/host.c
    src/enet/list.c
    src/enet/callbacks.c
    src/enet/packet.c
    src/enet/peer.c
    src/enet/protocol.c
    src/enet/unix.c
    src/enet/win32.c
    : <link>static <include>src/enet/include
    @DEFINE_HAS_GETHOSTBYADDR_R@
    @DEFINE_HAS_GETHOSTBYNAME_R@
    @DEFINE_HAS_POLL@
    @DEFINE_HAS_FCNTL@
    @DEFINE_HAS_INET_PTON@
    @DEFINE_HAS_INET_NTOP@
    @DEFINE_HAS_MSGHDR_FLAGS@
    @DEFINE_HAS_SOCKLEN_T@
    @DEFINE_ENET_BUFFER_MAXIMUM@
    @DEFINE_USE_CRC32@
    : : <include>src/enet/include ;

lib z : : <name>z ;
lib geoip : : <name>GeoIP <link>shared ;
lib rt : : <name>rt ;
lib pthread : : <name>pthread <link>shared ;

cpp-pch pch : src/hopmod/pch.hpp /fungu//script : <include>src/shared <include>src/enet/include <define>STANDALONE ;

lib sauertools :
    src/shared/tools.cpp
    src/shared/stream.cpp
    src/shared/crypto.cpp
    : <include>src/shared <include>src/enet/include <define>STANDALONE <link>static
    : : <include>src/shared <include>src/enet/include ;

lib lua_modules :
    src/hopmod/lua/crypto.cpp
    src/hopmod/md5.c
    src/hopmod/lua/net.cpp
    src/hopmod/lua/cubescript.cpp
    src/hopmod/lua/geoip.cpp
    src/hopmod/lua/filesystem.cpp
    src/hopmod/lua/packlib.c 
    /lua//lua
    /boost//headers
    /boost//signals
    /boost//system
    /fungu//script
    geoip
    sauertools
    pthread
    : <define>STANDALONE <include>src/hopmod <link>static ;

lib serverscripting :
    src/hopmod/signals.cpp
    src/hopmod/scripting.cpp
    /lua//lua
    /boost//headers
    /boost//signals
    /boost//system
    /fungu//script
    lua_modules
    pch
    : <link>static <include>src/hopmod <include>src/shared <include>src/enet/include <define>STANDALONE : : <include>src ;

lib scriptpipe :
    src/hopmod/script_pipe.cpp
    serverscripting
    : <link>static <include>src/shared <include>src/enet/include <define>STANDALONE ;

exe sauer_server :
    src/engine/server.cpp
    src/fpsgame/server.cpp
    src/hopmod/startup.cpp
    src/hopmod/scripting.cpp
    src/hopmod/script_bindings.cpp
    src/hopmod/script_pipe.cpp
    src/hopmod/script_socket.cpp
    src/hopmod/parse_player_command.cpp
    src/hopmod/process_player_command.cpp
    src/hopmod/scheduler.cpp
    src/hopmod/playerid.cpp
    src/hopmod/restarter.cpp
    src/hopmod/utils.cpp
    src/hopmod/netmask.cpp
    src/hopmod/bans.cpp
    sauertools
    serverscripting
    scriptpipe
    z
    enet
    /boost//headers
    /libmicrohttpd//microhttpd
    rt
    pch
    : <define>STANDALONE 
      <define>HOPMOD_GAMESERVER_EVENTS
      <include>src/fpsgame
      <include>src/hopmod ;

exe keygen :
    sauertools
    z
    src/hopmod/keygen.cpp : <define>STANDALONE ;
    
exe sauer_authserver :
    src/hopmod/authserver.cpp
    sauertools
    serverscripting
    scriptpipe
    enet
    : <define>STANDALONE <define>HOPMOD_AUTHSERVER_EVENTS ;

exe luapp :
    src/hopmod/luapp.cpp
    /lua//lua
    /boost//headers
    /boost//system
    lua_modules
    : <define>STANDALONE ;

install executables : sauer_server keygen luapp : <install-type>EXE <location>bin ;
install libraries : /boost//system /boost//signals /lua//lua /lua-sqlite3//luasqlite3 /libmicrohttpd//microhttpd : <install-type>LIB <location>lib ;

install install_sauer_authserver : sauer_authserver : <install-type>EXE <install-type>LIB <location>bin ;
explicit sauer_authserver ;
explicit install_sauer_authserver ;

install lua-packages :
    /lua-sqlite3//script-package : <location>$(SCRIPT_PACKAGE_PATH) ;

