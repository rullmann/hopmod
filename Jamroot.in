
path-constant LIB_PATH : bin ;
path-constant SCRIPT_PACKAGE_PATH : script/package ;

use-project /boost : src/boost ;
use-project /lua : src/lua ;
use-project /fungu : src/fungu ;
use-project /lua-sqlite3 : src/lua-sqlite3 ;

build-project src/lua-socket ;

lib enet : 
    src/enet/host.c
    src/enet/list.c
    src/enet/callbacks.c
    src/enet/packet.c
    src/enet/peer.c
    src/enet/protocol.c
    src/enet/unix.c
    src/enet/win32.c
    : <link>static <include>src/enet/include
    @DEFINE_HAS_GETHOSTBYADDR_R@
    @DEFINE_HAS_GETHOSTBYNAME_R@
    @DEFINE_HAS_POLL@
    @DEFINE_HAS_FCNTL@
    @DEFINE_HAS_INET_PTON@
    @DEFINE_HAS_INET_NTOP@ 
    @DEFINE_HAS_MSGHDR_FLAGS@ 
    @DEFINE_HAS_SOCKLEN_T@ 
    @DEFINE_ENET_BUFFER_MAXIMUM@ 
    @DEFINE_USE_CRC32@ 
    : : <include>src/enet/include ;

lib z : : <name>z ;
lib dl : : <name>dl ;

without_geoip = @WITHOUT_GEOIP@ ;
if $(without_geoip) = 1 {
    alias geoip : : : : <define>WITHOUT_GEOIP ;
} else {
    lib geoip : : <name>GeoIP ;
}

without_microhttpd = @WITHOUT_MICROHTTPD@ ;
if $(without_microhttpd) = 1 {
    alias microhttpd : : : : <define>WITHOUT_MICROHTTPD ;
} else {
    lib microhttpd : : <name>microhttpd ;
}

without_test_project = @WITHOUT_TEST_PROJECT@ ;
if $(without_test_project) = 0 {
    build-project src/hopmod/test ;
}

exe sauer_server : 
    src/shared/tools.cpp
    src/shared/stream.cpp
    src/shared/zip.cpp
    src/shared/crypto.cpp
    src/engine/server.cpp
    src/fpsgame/server.cpp
    src/hopmod/floodprotection.cpp
    src/hopmod/scripting.cpp
    src/hopmod/script_bindings.cpp
    src/hopmod/signals.cpp
    src/hopmod/script_pipe.cpp
    src/hopmod/script_socket.cpp
    src/hopmod/parse_player_command.cpp
    src/hopmod/process_player_command.cpp
    src/hopmod/scheduler.cpp
    src/hopmod/geoip.cpp
    src/hopmod/banlist.cpp
    src/hopmod/playerid.cpp
    src/hopmod/restarter.cpp
    src/hopmod/utils.cpp
    enet
    z
    dl
    /lua//lua
    /fungu//script
    geoip
    microhttpd
    /boost//headers
    /boost//signals
    : <define>STANDALONE <include>src/shared <include>src/fpsgame <include>src/hopmod ;

install dist : sauer_server /lua//luashell /lua-sqlite3//luasqlite3 : <install-dependencies>on <install-type>LIB <install-type>EXE <location>bin ;

install lua-packages : 
    /lua-sqlite3//script-package : <location>$(SCRIPT_PACKAGE_PATH) ;
